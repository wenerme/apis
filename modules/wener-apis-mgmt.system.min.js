System.register(["react","antd","@wener/apis-boot","@ant-design/icons"],(function(e){"use strict";var t,n,r,o,i,a,l,s,c,d,u,m,p,f,v,h,y,b,g,E,O,w,P,j,M,I;return{setters:[function(e){t=e.useCallback,n=e.useState,r=e.default,o=e.useRef,i=e.useEffect},function(e){a=e.List,l=e.Skeleton,s=e.Tag,c=e.Button,d=e.Dropdown,u=e.Menu,m=e.Form,p=e.Modal,f=e.Input,v=e.notification,h=e.message},function(e){y=e.getBootService,b=e.loadImportOverrides,g=e.persistImportOverrides},function(e){E=e.UploadOutlined,O=e.EditOutlined,w=e.MinusSquareOutlined,P=e.DownOutlined,j=e.PlusSquareOutlined,M=e.ClearOutlined,I=e.ReloadOutlined}],execute:function(){var A=[{id:"boot",name:"@wener/apis-boot",metadata:{name:"@wneer/apis-boot",title:"启动模块",description:"控制映射模块，控制模块版本。"}},{id:"client",name:"@wener/apis-client",metadata:{title:"RPC Client",description:"远程调用客户端"}},{id:"crypto",name:"@wener/apis-crypto",metadata:{title:"加密哈希工具",description:"提供常用的加密算法、哈希算法"}},{id:"dash",name:"@wener/apis-dash",metadata:{title:"公共布局组件",description:"Dashboard、Layout 等组件"}},{id:"geo",name:"@wener/apis-geo",metadata:{title:"定位工具",description:"基于HTML技术获取定位信息"}},{id:"i18n",name:"@wener/apis-i18n",metadata:{title:"本地化",description:"提供英文翻译"}},{id:"ipfs",name:"@wener/apis-ipfs",metadata:{title:"IPFS 工具",description:"网管检测"}},{id:"lang-xml",name:"@wener/apis-lang-xml",metadata:{title:"XML工具",description:"XML格式化、JSON 转换、生成"}},{id:"langs",name:"@wener/apis-langs"},{id:"lite",name:"@wener/apis-lite",metadata:{title:"Wener's APIs Lite version",description:"APIs Lite - basic setup and configuration to bootstrap"}},{id:"mgmt",name:"@wener/apis-mgmt",metadata:{title:"应用管理",description:"模块管理，本地模块开发，模块更新发布。"}},{id:"password",name:"@wener/apis-password",metadata:{title:"密码校验",description:"Zxcvvn 密码强度检测"}},{id:"phone",name:"@wener/apis-phone",metadata:{title:"电话号码工具",description:"号码归属地查询"}},{id:"polyfill",name:"@wener/apis-polyfill",metadata:{title:"浏览器兼容",description:"添加 babel 需要的 runtime - corejs、regenerator"}},{id:"qrcode",name:"@wener/apis-qrcode",metadata:{title:"二维码",description:"二维码生成、二维码照片识别",externals:{pngjs:"https://cdn.jsdelivr.net/npm/pngjs@5.0.0/browser.min.js"}}},{id:"root",name:"@wener/apis-root",metadata:{title:"APIs 应用",description:"菜单、路由、页面布局控制；动态加载外部组件；Single SPA root config；"}},{id:"test",name:"@wener/apis-test",metadata:{title:"测试模块",description:"测试 Ping 接口；Single SPA 测试应用"}},{id:"uri",name:"@wener/apis-uri",metadata:{title:"URL工具",description:"解析、格式化 URL"}},{id:"webrtc",name:"@wener/apis-webrtc",metadata:{title:"WebRTC 工具",description:"WebRTC浏览器兼容检测"}}];class S{constructor(){this._boot=y(),this._modules=this._boot.modules,this.System=this._boot.System}async addOverrideModule({name:e,resolved:t}){this._modules.overrides[e]=t,await this.persistImportOverrides()}async removeOverrideModule({name:e}){delete this._modules.overrides[e],await this.persistImportOverrides()}async resetOverrideModules(){this._modules.overrides={},await this.persistImportOverrides()}async loadImportOverrides(){Object.assign(this._modules.overrides,await b())}async persistImportOverrides(){return await g(this._modules.overrides)}getModules(){const{System:e,_modules:t}=this;let n=[];n=n.concat(Object.entries(t.imports).map(([e,t])=>({name:e,resolved:t,predefined:!0})));{const e=C(n,"name");for(const n of A){const r=e[n.name]=e[n.name]||{name:n.name,resolved:t.tryResolve(n.name)};Object.assign(r,n)}for(const[n,r]of Object.entries(t.overrides))e[n]=Object.assign(e[n]||{},{name:n,resolved:r,override:!0});n=Object.values(e)}const r=C(n,"resolved");for(const[n,o]of e.entries()){if(!o)continue;const e=r[n]=r[n]||{name:t.resolveName(n)||n,resolved:n};e.loaded=!0,t.isInternal(e.name)&&(e.metadata=o.metadata||{})}n=Object.values(r),n.forEach(e=>{var n;e.internal=t.isInternal(e.name),e.hasMetadata=Boolean(Object.keys(e.metadata||{}).length),e.source=(n=e.resolved).startsWith("https://cdn.jsdelivr.net/npm/")?"jsdelivr":n.startsWith("https://unpkg.com/")?"unpkg":n.startsWith(location.origin)?"site":/^https?:\/\/(localhost|127\.0\.0|192\.168|10\.)/.test(n)?"localhost":"unknown",e.version=function(e){const t="https://cdn.jsdelivr.net/npm/";if(e.startsWith(t)){const n=e.substr(t.length).match(/(^@[^/]+[/])?[^/@]+@([^/]+)/);if(n)return n[2]}return"latest"}(e.resolved),e.dependencies=Array.from(t.dependencies[e.name]||[])});const o={};return n.flatMap(({name:e,dependencies:t})=>t.map(t=>[t,e])).reduce((e,[t,n])=>((e[t]=e[t]||[]).push(n),e),o),n.forEach(e=>{e.dependents=o[e.name]||[]}),n}}function C(e,t){return Object.fromEntries(e.map(e=>[e[t],e]))}function k(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("production"!==process.env.NODE_ENV){var o=fe[e],i=o?"function"==typeof o?o.apply(null,n):o:"unknown error nr: "+e;throw Error("[Immer] "+i)}throw Error("[Immer] minified error nr: "+e+(n.length?" "+n.join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function D(e){return!!e&&!!e[pe]}function N(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);return!t||t===Object.prototype}(e)||Array.isArray(e)||!!e[me]||!!e.constructor[me]||F(e)||W(e))}function _(e,t,n){void 0===n&&(n=!1),0===R(e)?(n?Object.keys:ve)(e).forEach((function(n){return t(n,e[n],e)})):e.forEach((function(n,r){return t(r,n,e)}))}function R(e){var t=e[pe];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:F(e)?2:W(e)?3:0}function x(e,t){return 2===R(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function L(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function F(e){return se&&e instanceof Map}function W(e){return ce&&e instanceof Set}function z(e){return e.o||e.t}function V(e,t){if(void 0===t&&(t=!1),Array.isArray(e))return e.slice();var n=Object.create(Object.getPrototypeOf(e));return _(e,(function(r){if(r!==pe){var o=Object.getOwnPropertyDescriptor(e,r),i=o.value;o.get&&(t||k(1),i=o.get.call(e)),o.enumerable?n[r]=i:Object.defineProperty(n,r,{value:i,writable:!0,configurable:!0})}})),n}function T(e,t){D(e)||q(e)||!N(e)||(R(e)>1&&(e.set=e.add=e.clear=e.delete=U),Object.freeze(e),t&&_(e,(function(e,t){return T(t,!0)}),!0))}function U(){k(2)}function q(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function B(e){var t=he[e];return t||k("production"!==process.env.NODE_ENV?18:19,e),t}function K(){return"production"===process.env.NODE_ENV||ae||k(0),ae}function X(e,t){t&&(B("Patches"),e.u=[],e.s=[],e.v=t)}function J(e){$(e),e.p.forEach(H),e.p=null}function $(e){e===ae&&(ae=e.l)}function G(e){return ae={p:[],l:ae,h:e,m:!0,_:0}}function H(e){var t=e[pe];0===t.i||1===t.i?t.j():t.O=!0}function Z(e,t){t._=t.p.length;var n=t.p[0],r=void 0!==e&&e!==n;return t.h.g||B("ES5").S(t,e,r),r?(n[pe].P&&(J(t),k(4)),N(e)&&(e=Q(t,e),t.l||ee(t,e)),t.u&&B("Patches").M(n[pe],e,t.u,t.s)):e=Q(t,n,[]),J(t),t.u&&t.v(t.u,t.s),e!==ue?e:void 0}function Q(e,t,n){if(q(t))return t;var r=t[pe];if(!r)return _(t,(function(o,i){return Y(e,r,t,o,i,n)}),!0),t;if(r.A!==e)return t;if(!r.P)return ee(e,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var o=4===r.i||5===r.i?r.o=V(r.k,!0):r.o;_(o,(function(t,i){return Y(e,r,o,t,i,n)})),ee(e,o,!1),n&&e.u&&B("Patches").R(r,n,e.u,e.s)}return r.o}function Y(e,t,n,r,o,i){if("production"!==process.env.NODE_ENV&&o===n&&k(5),D(o)){var a=Q(e,o,i&&t&&3!==t.i&&!x(t.D,r)?i.concat(r):void 0);if(s=r,c=a,2===(d=R(l=n))?l.set(s,c):3===d?(l.delete(s),l.add(c)):l[s]=c,!D(a))return;e.m=!1}var l,s,c,d;if((!t||!L(o,function(e,t){return 2===R(e)?e.get(t):e[t]}(t.t,r)))&&N(o)){if(!e.h.N&&e._<1)return;Q(e,o),t&&t.A.l||ee(e,o)}}function ee(e,t,n){void 0===n&&(n=!1),e.h.N&&e.m&&T(t,n)}function te(e,t){var n=e[pe],r=Reflect.getOwnPropertyDescriptor(n?z(n):e,t);return r&&r.value}function ne(e){if(!e.P){if(e.P=!0,0===e.i||1===e.i){var t=e.o=V(e.t);_(e.p,(function(e,n){t[e]=n})),e.p=void 0}e.l&&ne(e.l)}}function re(e){e.o||(e.o=V(e.t))}function oe(e,t,n){var r=F(t)?B("MapSet").T(t,n):W(t)?B("MapSet").F(t,n):e.g?function(e,t){var n=Array.isArray(e),r={i:n?1:0,A:t?t.A:K(),P:!1,I:!1,D:{},l:t,t:e,k:null,p:{},o:null,j:null,C:!1},o=r,i=ye;n&&(o=[r],i=be);var a=Proxy.revocable(o,i),l=a.revoke,s=a.proxy;return r.k=s,r.j=l,s}(t,n):B("ES5").J(t,n);return(n?n.A:K()).p.push(r),r}var ie,ae,le="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),se="undefined"!=typeof Map,ce="undefined"!=typeof Set,de="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,ue=le?Symbol("immer-nothing"):((ie={})["immer-nothing"]=!0,ie),me=le?Symbol("immer-draftable"):"__$immer_draftable",pe=le?Symbol("immer-state"):"__$immer_state",fe={0:"Illegal state",1:"Immer drafts cannot have computed properties",2:"This object has been frozen and should not be mutated",3:function(e){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+e},4:"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.",5:"Immer forbids circular references",6:"The first or second argument to `produce` must be a function",7:"The third argument to `produce` must be a function or undefined",8:"First argument to `createDraft` must be a plain object, an array, or an immerable object",9:"First argument to `finishDraft` must be a draft returned by `createDraft`",10:"The given draft is already finalized",11:"Object.defineProperty() cannot be used on an Immer draft",12:"Object.setPrototypeOf() cannot be used on an Immer draft",13:"Immer only supports deleting array indices",14:"Immer only supports setting array indices and the 'length' property",15:function(e){return"Cannot apply patch, path doesn't resolve: "+e},16:'Sets cannot have "replace" patches.',17:function(e){return"Unsupported patch operation: "+e},18:function(e){return"The plugin for '"+e+"' has not been loaded into Immer. To enable the plugin, import and call `enable"+e+"()` when initializing your application."},19:function(e){return"plugin not loaded: "+e},20:"Cannot use proxies if Proxy, Proxy.revocable or Reflect are not available"},ve="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,he={},ye={get:function(e,t){if(t===pe)return e;var n=e.p;if(!e.P&&x(n,t))return n[t];var r=z(e)[t];if(e.I||!N(r))return r;if(e.P){if(r!==te(e.t,t))return r;n=e.o}return n[t]=oe(e.A.h,r,e)},has:function(e,t){return t in z(e)},ownKeys:function(e){return Reflect.ownKeys(z(e))},set:function(e,t,n){if(!e.P){var r=te(e.t,t);if(n?L(r,n)||n===e.p[t]:L(r,n)&&t in e.t)return!0;re(e),ne(e)}return e.D[t]=!0,e.o[t]=n,!0},deleteProperty:function(e,t){return void 0!==te(e.t,t)||t in e.t?(e.D[t]=!1,re(e),ne(e)):e.D[t]&&delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var n=z(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r&&(r.writable=!0,r.configurable=1!==e.i||"length"!==t),r},defineProperty:function(){k(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){k(12)}},be={};_(ye,(function(e,t){be[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),be.deleteProperty=function(e,t){return"production"!==process.env.NODE_ENV&&isNaN(parseInt(t))&&k(13),ye.deleteProperty.call(this,e[0],t)},be.set=function(e,t,n){return"production"!==process.env.NODE_ENV&&"length"!==t&&isNaN(parseInt(t))&&k(14),ye.set.call(this,e[0],t,n,e[0])};var ge=new(function(){function e(e){this.g=de,this.N="production"!==process.env.NODE_ENV,"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),this.produce=this.produce.bind(this),this.produceWithPatches=this.produceWithPatches.bind(this)}var t=e.prototype;return t.produce=function(e,t,n){if("function"==typeof e&&"function"!=typeof t){var r=t;t=e;var o=this;return function(e){var n=this;void 0===e&&(e=r);for(var i=arguments.length,a=Array(i>1?i-1:0),l=1;l<i;l++)a[l-1]=arguments[l];return o.produce(e,(function(e){var r;return(r=t).call.apply(r,[n,e].concat(a))}))}}var i;if("function"!=typeof t&&k(6),void 0!==n&&"function"!=typeof n&&k(7),N(e)){var a=G(this),l=oe(this,e,void 0),s=!0;try{i=t(l),s=!1}finally{s?J(a):$(a)}return"undefined"!=typeof Promise&&i instanceof Promise?i.then((function(e){return X(a,n),Z(e,a)}),(function(e){throw J(a),e})):(X(a,n),Z(i,a))}if((i=t(e))!==ue)return void 0===i&&(i=e),this.N&&T(i,!0),i},t.produceWithPatches=function(e,t){var n,r,o=this;return"function"==typeof e?function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return o.produceWithPatches(t,(function(t){return e.apply(void 0,[t].concat(r))}))}:[this.produce(e,t,(function(e,t){n=e,r=t})),n,r]},t.createDraft=function(e){N(e)||k(8);var t=G(this),n=oe(this,e,void 0);return n[pe].C=!0,$(t),n},t.finishDraft=function(e,t){var n=e&&e[pe];"production"!==process.env.NODE_ENV&&(n&&n.C||k(9),n.I&&k(10));var r=n.A;return X(r,t),Z(void 0,r)},t.setAutoFreeze=function(e){this.N=e},t.setUseProxies=function(e){de||k(20),this.g=e},t.applyPatches=function(e,t){var n;for(n=t.length-1;n>=0;n--){var r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}var o=B("Patches").U;return D(e)?o(e,t):this.produce(e,(function(e){return o(e,t.slice(n+1))}))},e}()),Ee=ge.produce;ge.produceWithPatches.bind(ge),ge.setAutoFreeze.bind(ge),ge.setUseProxies.bind(ge),ge.applyPatches.bind(ge),ge.createDraft.bind(ge),ge.finishDraft.bind(ge);function Oe(e){var r=n(e),o=r[1];return[r[0],t((function(e){o(Ee(e))}),[])]}const we=({loading:e,modules:t,renderActions:n=(e=>[])})=>r.createElement("div",null,r.createElement(a,{loading:e,itemLayout:"horizontal",dataSource:t,renderItem:e=>{var t,o,i;return r.createElement(a.Item,{actions:[...n(e)]},r.createElement(l,{avatar:!0,title:!1,loading:e.loading,active:!0},r.createElement(a.Item.Meta,{title:r.createElement("div",null,r.createElement("span",null,e.name+((null===(t=e.metadata)||void 0===t?void 0:t.title)?" / "+(null===(o=e.metadata)||void 0===o?void 0:o.title):"")),r.createElement("span",{style:{paddingLeft:10}},e.loaded&&r.createElement(s,{color:"magenta"},"已加载"),e.predefined&&r.createElement(s,{color:"green"},"预定义"),e.internal&&r.createElement(s,{color:"lime"},"内部模块"),e.hasMetadata&&r.createElement(s,{color:"gold"},"含元数据"),e.override&&r.createElement(s,{color:"geekblue"},"覆盖"))),description:null===(i=e.metadata)||void 0===i?void 0:i.description}),r.createElement("div",null,r.createElement("div",null,r.createElement("small",null,e.resolved),r.createElement("span",{style:{paddingLeft:8}},r.createElement(s,null,e.version),r.createElement(s,null,e.source))),r.createElement("div",{style:{maxWidth:"30vw"}},Boolean(e.dependencies.length)&&r.createElement("div",null,r.createElement("small",null,"依赖: ",e.dependencies.join(","))),Boolean(e.dependents.length)&&r.createElement("div",null,r.createElement("small",null,"被依赖: ",e.dependents.join(",")))))))}}));let Pe;e("ModuleManagementPanel",()=>{const e=Pe=Pe||new S,t=y().System,[n,o]=Oe(()=>e.getModules().sort((e,t)=>e.name.localeCompare(t.name))),i=()=>{o(t=>e.getModules().sort((e,t)=>e.name.localeCompare(t.name)))},a=async t=>{await e.addOverrideModule(t),i()},l=async e=>{o(t=>{t.find(t=>t.name===e).loading=!0});try{await t.import(e),o(t=>{const n=t.find(t=>t.name===e);n.loading=!1,n.loaded=!0,n.dependencies=Array.from(y().modules.dependencies[e]||[]);for(const r of n.dependencies){const n=t.find(e=>e.name===r);n&&!n.dependents.includes(e)&&(n.dependents=[...n.dependents,e])}})}catch(t){v.error({message:String(t)}),o(t=>{const n=t.find(t=>t.name===e);n.loading=!1,n.loaded=!1})}},s=e=>{o(n=>{const r=n.find(t=>t.name===e);t.delete(r.resolved),r.loading=!1,r.loaded=t.has(r.resolved)})},[c,d]=Oe({editing:!1,module:void 0});return r.createElement("div",null,r.createElement(Me,{visible:c.editing,module:c.module,onModuleChange:async e=>a(e),onVisibleChange:e=>d(t=>{t.editing=e})}),r.createElement("div",null,r.createElement(Ie,{onRefresh:i,onResetLocalModule:async()=>{await e.resetOverrideModules(),i()},onAddLocalModule:a})),r.createElement(we,{modules:n,onModuleLoad:l,onModuleUnload:s,renderActions:je({onModuleUnload:s,onModuleLoad:l,onModuleReset:async t=>{await e.removeOverrideModule(t),i()},onModuleEdit:e=>{d(t=>{t.editing=!0,t.module=e})},onModulePublish:e=>{h.warn("尚未实现")}})}))});function je(e){const{onModuleLoad:t,onModuleUnload:n,onModuleEdit:o,onModulePublish:i,onModuleReset:a}=e;return e=>[r.createElement(c,{onClick:()=>t(e.name),type:"link",key:"load",size:"small",disabled:e.loaded},"加载"),r.createElement(c,{onClick:()=>n(e.name),type:"link",key:"unload",size:"small",disabled:!e.loaded},"卸载"),r.createElement(d,{key:"more",overlay:r.createElement(u,null,r.createElement(u.Item,{onClick:()=>i(e),icon:r.createElement(E,null)},"发布"),r.createElement(u.Item,{onClick:()=>o(e),icon:r.createElement(O,null)},"编辑"),r.createElement(u.Item,{onClick:()=>a(e),disabled:!e.override,icon:r.createElement(w,null)},"重置本地覆盖"))},r.createElement("a",{className:"ant-dropdown-link",onClick:e=>e.preventDefault()},"操作 ",r.createElement(P,null)))]}const Me=({visible:e,onVisibleChange:t,module:n,onModuleChange:a})=>{const[l]=m.useForm(),s=o(n);return i(()=>{n&&s.current!==n&&(s.current=n,l.setFieldsValue(n))},[n]),r.createElement(p,{title:"模块",onOk:()=>l.submit(),visible:e,onCancel:()=>t(!1)},r.createElement(m,{form:l,labelCol:{span:4},wrapperCol:{span:20},initialValues:n||{},onFinish:e=>{!1!==a(e)&&t(!1)}},r.createElement(m.Item,{name:"name",label:"模块名",required:!0,rules:[{required:!0}]},r.createElement(f,null)),r.createElement(m.Item,{name:"resolved",label:"地址",required:!0,rules:[{required:!0}]},r.createElement(f,null))))},Ie=({onRefresh:e,onResetLocalModule:t,onAddLocalModule:n})=>{const[o,i]=Oe({editing:!1});return r.createElement("div",null,r.createElement(Me,{visible:o.editing,onVisibleChange:e=>i(t=>{t.editing=e}),onModuleChange:n}),r.createElement("div",{style:{display:"flex",gap:8}},r.createElement(c.Group,null,r.createElement(c,{type:"primary",icon:r.createElement(j,null),onClick:()=>i(e=>{e.editing=!0})},"本地"),r.createElement(c,{onClick:t,icon:r.createElement(M,null)},"重置")),r.createElement(c,{onClick:e,icon:r.createElement(I,null)},"刷新")))};e("metadata",{title:"应用管理",description:"模块管理，本地模块开发，模块更新发布。"})}}}));
//# sourceMappingURL=wener-apis-mgmt.system.min.js.map
